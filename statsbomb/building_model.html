<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Farid Musayev">
<meta name="dcterms.date" content="2022-09-06">

<title>Part 3 | Building Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="building_model_files/libs/clipboard/clipboard.min.js"></script>
<script src="building_model_files/libs/quarto-html/quarto.js"></script>
<script src="building_model_files/libs/quarto-html/popper.min.js"></script>
<script src="building_model_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="building_model_files/libs/quarto-html/anchor.min.js"></script>
<link href="building_model_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="building_model_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="building_model_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="building_model_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="building_model_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#package-prerequisites" id="toc-package-prerequisites" class="nav-link active" data-scroll-target="#package-prerequisites">Package prerequisites</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#distance-angle-features" id="toc-distance-angle-features" class="nav-link" data-scroll-target="#distance-angle-features">Distance &amp; Angle Features</a></li>
  </ul></li>
  <li><a href="#statistical-analysis-of-features" id="toc-statistical-analysis-of-features" class="nav-link" data-scroll-target="#statistical-analysis-of-features">Statistical Analysis of Features</a></li>
  <li><a href="#transforming-and-splitting-data" id="toc-transforming-and-splitting-data" class="nav-link" data-scroll-target="#transforming-and-splitting-data">Transforming and Splitting Data</a></li>
  <li><a href="#models-comparison" id="toc-models-comparison" class="nav-link" data-scroll-target="#models-comparison">Modelsâ€™ Comparison</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Part 3 | Building Model</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
<p class="subtitle lead">Feature engineering, model evaluation and hyperparameter tuning</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Farid Musayev </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 6, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<style> body {text-align: justify} </style>
<p><!-- Justify text. --></p>
<section id="package-prerequisites" class="level2">
<h2 class="anchored" data-anchor-id="package-prerequisites">Package prerequisites</h2>
<p>In this part, the following libraries need to be imported.</p>
<div class="cell" data-execution_count="110">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ast</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> cm</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mplsoccer <span class="im">import</span> Pitch, VerticalPitch</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_formats <span class="op">=</span> [<span class="st">'png'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<p>First of all, I read a preprocessed (see Part 1 and Part 2) <code>.csv</code> data file and convert all required columns to python readable object types.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read shots.csv file </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>shots <span class="op">=</span> pd.read_csv(<span class="st">'.data/shots.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>shots.loc[:, <span class="st">'freeze_frame'</span>] <span class="op">=</span> shots.loc[:, <span class="st">'freeze_frame'</span>].<span class="bu">apply</span>(ast.literal_eval)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>shots.loc[:, <span class="st">'gk_loc'</span>] <span class="op">=</span> shots.loc[:, <span class="st">'gk_loc'</span>].<span class="bu">apply</span>(ast.literal_eval)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>shots.loc[:, <span class="st">'end_loc'</span>] <span class="op">=</span> shots.loc[:, <span class="st">'end_loc'</span>].<span class="bu">apply</span>(ast.literal_eval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Prediction of a goal outcome in soccer is a binary classification task { 0 - No goal ; 1 - Goal }. However, the key point to note is that, in xG model, we are not dealing with hard classes but rather trying to make a probabilistic prediction for a shot outcome. In comparison with hard classes, probabilistic outputs allow to better understand the quality of shot. In other words, given a shot, how likely it is to result into a goal. This is what xG value estimates for a given shot.</p>
<p>As you can see from below code snippet, there are different outcome types for a given shot such as <em>Saved</em>, <em>Off target</em>, shot that hit <em>Post</em>, <em>Blocked</em>, way off target <em>Wayward</em> shot and etc. To build a binary probabilistic classifier, it is necessary for us to define predictions as hard classes. Here, I convert each value of <code>outcome_type</code> column to 1 for <em>Goal</em> scenario or 0 for the rest of scenarios.</p>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>shots.loc[:, <span class="st">'outcome'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array(['Saved', 'Off T', 'Post', 'Goal', 'Blocked', 'Wayward',
       'Saved Off Target', 'Saved to Post'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename existing 'outcome' column to 'outcome_type' </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>shots <span class="op">=</span> shots.rename(columns <span class="op">=</span> {<span class="st">'outcome'</span>: <span class="st">'outcome_type'</span>})</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># save binary results into a newly created 'outcome' column</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>shots.loc[:, <span class="st">'outcome'</span>] <span class="op">=</span> shots.loc[:, <span class="st">'outcome_type'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'Goal'</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>shots.loc[:, <span class="st">'outcome'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>0        0
1        0
2        0
3        0
4        0
        ..
11038    0
11039    0
11040    0
11041    0
11042    0
Name: outcome, Length: 11043, dtype: int64</code></pre>
</div>
</div>
<p>Now, let us analyze the types of available shots and their corresponding distribution. From <a href="#fig-1">Figure&nbsp;1</a> it can be seen that our dataframe has a data on 11043 shots. As we can see below, 1165 of them resulted into a goal.</p>
<div class="cell" data-execution_count="138">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>shot_types <span class="op">=</span> pd.DataFrame(shots.loc[:, <span class="st">'outcome_type'</span>].value_counts()).reset_index()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>shot_types.columns <span class="op">=</span> [<span class="st">'outcome_type'</span>, <span class="st">'n'</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>shot_types <span class="op">=</span> shot_types.sort_values(by <span class="op">=</span> <span class="st">'n'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Canvas</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># grid specs</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>ax.grid(color <span class="op">=</span> <span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Main plot</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>pl <span class="op">=</span> ax.barh(shot_types[<span class="st">"outcome_type"</span>], shot_types[<span class="st">"n"</span>], height <span class="op">=</span> <span class="fl">0.6</span>, label <span class="op">=</span> <span class="st">'n'</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>       color <span class="op">=</span> <span class="st">'skyblue'</span>, edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot labels</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>ax.bar_label(pl, padding <span class="op">=</span> <span class="dv">5</span>, label_type<span class="op">=</span><span class="st">'edge'</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels and titles</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Outcome Type"</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"# of instances"</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis <span class="op">=</span> <span class="st">'both'</span>, which <span class="op">=</span> <span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">""</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">1</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>ax.spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="building_model_files/figure-html/fig-1-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure 1: Distribution of shot outcomes across female soccer competitions.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>To sum up, we can see that the majority of shots are off target, blocked or saved. Out of 11043 shots, only 1165 are goals. Thus, we can conclude that our data is imbalanced.</p>
<p>Next, we can visualize the location of all shots.</p>
<div class="cell" data-execution_count="135">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canvas</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>pitch <span class="op">=</span> Pitch(pitch_type <span class="op">=</span> <span class="st">'statsbomb'</span>)  </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> pitch.draw(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">8</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> shots, x <span class="op">=</span> <span class="st">'x_start'</span>, y <span class="op">=</span> <span class="st">'y_start'</span>, ax <span class="op">=</span> ax,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                hue <span class="op">=</span> <span class="st">'outcome'</span>, palette <span class="op">=</span> <span class="st">'seismic'</span>, edgecolor <span class="op">=</span> <span class="st">'black'</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># legend design</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.lines <span class="im">import</span> Line2D</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>custom <span class="op">=</span> [Line2D([], [], marker<span class="op">=</span><span class="st">'.'</span>, color<span class="op">=</span><span class="st">'b'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>          Line2D([], [], marker<span class="op">=</span><span class="st">'.'</span>, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>)]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>plt.legend(custom, [<span class="st">'No Goal'</span>, <span class="st">'Goal'</span>], bbox_to_anchor<span class="op">=</span>(<span class="fl">0.05</span>, <span class="fl">0.21</span>))</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrow </span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>arrow_ax <span class="op">=</span> fig.add_axes([<span class="fl">0.28</span>, <span class="fl">0.22</span>, <span class="fl">0.35</span>, <span class="fl">0.3</span>]) <span class="co"># X, Y, width, height</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>arrow_ax.arrow(<span class="fl">0.45</span>, <span class="fl">0.1</span>, <span class="fl">0.30</span>, <span class="dv">0</span>, head_width<span class="op">=</span><span class="fl">0.03</span>, head_length<span class="op">=</span><span class="fl">0.03</span>, linewidth<span class="op">=</span><span class="dv">4</span>, </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'darkgrey'</span>, length_includes_head<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>arrow_ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>arrow_ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>arrow_ax.set_axis_off()</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>arrow_ax.annotate(<span class="st">'Direction of Play'</span>, xy <span class="op">=</span> (<span class="fl">0.42</span>, <span class="fl">0.02</span>), fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="building_model_files/figure-html/fig-2-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure 2: Distribution of shots according to their coordinates.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The majority of shots is made in the central block of the final third area. In addition, there are several outlying shots made from a central area and flang positions. On the right flang, some of outliers even resulted into <em>Goal</em>.</p>
</section>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">Feature Engineering</h2>
<p>When it comes to the analysis of a shot made by a player, first of all, one can even intuitively predict whether that shot will have a decent outcome or not. In practice, there are two major factors which drive that intuition and can be actually quantified. These are <strong>distance</strong> to goal and <strong>angle</strong> under which shot was implemented.</p>
<div class="cell" data-execution_count="397">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_formats <span class="op">=</span> [<span class="st">'png'</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual shots on Pitch</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>pitch <span class="op">=</span> VerticalPitch(pitch_type <span class="op">=</span> <span class="st">'statsbomb'</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                      half <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                      pad_left <span class="op">=</span> <span class="dv">0</span>, pad_right <span class="op">=</span> <span class="dv">0</span>, pad_top <span class="op">=</span> <span class="dv">0</span>, pad_bottom <span class="op">=</span> <span class="fl">0.15</span>)  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> pitch.draw(nrows <span class="op">=</span> <span class="dv">1</span>, ncols <span class="op">=</span> <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">105</span>, <span class="dv">120</span>, <span class="dv">110</span>, <span class="dv">120</span>]).reshape(<span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.array([<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">40</span>, <span class="dv">40</span>, <span class="dv">40</span>]).reshape(<span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    pitch.goal_angle(x[i][<span class="dv">0</span>], y[i][<span class="dv">0</span>], ax <span class="op">=</span> ax[i], alpha <span class="op">=</span> <span class="fl">0.4</span>, color <span class="op">=</span> <span class="st">'skyblue'</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    pitch.lines(x[i][<span class="dv">0</span>], y[i][<span class="dv">0</span>], x[i][<span class="dv">1</span>], y[i][<span class="dv">1</span>], ax <span class="op">=</span> ax[i], linewidth <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="building_model_files/figure-html/fig-3-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure 3: Different distance to goal (solid line) and angle (shaded area) for a given shot.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="distance-angle-features" class="level3">
<h3 class="anchored" data-anchor-id="distance-angle-features">Distance &amp; Angle Features</h3>
<p>To demonstrate an impact of <strong>distance</strong> and <strong>angle</strong> features on a probability of a shot resulting into a goal, I evaluate these features from a given (x, y) coordinate of each shot and build a simple logistic regression that makes probabilitistic predictions.</p>
<p>To evaluate distance to the goal, I calculate euclidean distance between (x, y) coordinate of a shot and goal centerline. Since I work with Statsbomb data, I use their pitch dimensions which are [0, 120] on x axis and [0, 80] on y axis. Thus, goal centerline coordinates are (120, 40).</p>
<p>Below, you can see my implementation:</p>
<div class="cell" data-execution_count="237">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance Feature calculation</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define goal center for 'statsbomb'</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>goal_center <span class="op">=</span> np.array([<span class="dv">120</span>, <span class="dv">40</span>])</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate distance between shot and goal center</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">'distance'</span>] <span class="op">=</span> np.sqrt((shots[<span class="st">'x_start'</span>] <span class="op">-</span> goal_center[<span class="dv">0</span>])<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (shots[<span class="st">'y_start'</span>] <span class="op">-</span> goal_center[<span class="dv">1</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">'distance'</span>] <span class="op">=</span> shots[<span class="st">'distance'</span>].<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I calculate angle of a shot. To evaluate angle (alpha) of a shot, our task breaks down to finding an angle between two sides of a triangle given that all lengths (a, b, c) of triangle are known.</p>
<p>Below, you can see my implementation:</p>
<div class="cell" data-execution_count="238">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Angle Feature calculation</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># transform x, y coordinates from percentiles to field length coordinates (105 meters x 68 meters)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> shots[<span class="st">'x_start'</span>] <span class="op">*</span> <span class="dv">105</span><span class="op">/</span><span class="dv">120</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> shots[<span class="st">'y_start'</span>] <span class="op">*</span> <span class="dv">68</span><span class="op">/</span><span class="dv">80</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use trigonometric formula to find angle between two sides (a,b) of triangle where third side (c) </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># is a goal line of length 7.32</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.sqrt((x <span class="op">-</span> <span class="dv">105</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (y <span class="op">-</span> <span class="fl">30.34</span>)<span class="op">**</span><span class="dv">2</span>) <span class="co"># length between right post and (x,y) shot coordinate</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.sqrt((x <span class="op">-</span> <span class="dv">105</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (y <span class="op">-</span> <span class="fl">37.66</span>)<span class="op">**</span><span class="dv">2</span>) <span class="co"># length between left post and (x,y) shot coordinate</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fl">7.32</span> <span class="co"># goal line length in meters</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>cos_alpha <span class="op">=</span> (a<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> b<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> c<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>a<span class="op">*</span>b)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>cos_alpha <span class="op">=</span> np.<span class="bu">round</span>(cos_alpha, decimals <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># remember to leave angle in radians (if you want to transfer to degree multiply cos_alpha by 180/pi)</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">'angle'</span>] <span class="op">=</span> np.arccos(cos_alpha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, I would like to demonstrate how both of these features impact probability of scoring.</p>
<p>I run a simple logistic regression that includes only these features (distance, angle) and obtain probabilisitc predictions for each shot. Then, I plot both of these features against my probabilistic predictions to visualize the relationship. This is a raw model which does not make any kinds of feature preprocessing since the goal here is to illustrate relationship between our features and probability of scoring.</p>
<div class="cell" data-execution_count="394">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare features and labels from available data</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> shots.loc[:, [<span class="st">'distance'</span>, <span class="st">'angle'</span>]]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> shots.loc[:, <span class="st">'outcome'</span>]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Logistic Regression Model</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>xG_model <span class="op">=</span> LogisticRegression()</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>xG_model.fit(X, y)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># make predictions</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>xG_predictions <span class="op">=</span> xG_model.predict_proba(X)[:, <span class="dv">1</span>]</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Canvas</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">1</span>, ncols <span class="op">=</span> <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">14</span>, <span class="dv">4</span>))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance plot design</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># grid</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].grid(color <span class="op">=</span> <span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"both"</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].scatter(X[<span class="st">'distance'</span>], xG_predictions, color <span class="op">=</span> <span class="st">'gray'</span>, s <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">'Distance'</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">'Probability of scoring'</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># axis adjustments</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>, <span class="fl">0.8</span>)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlim(<span class="dv">0</span>, <span class="dv">90</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].yaxis.get_major_ticks()[<span class="dv">0</span>].label1.set_visible(<span class="va">False</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].tick_params(length <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co">############################################</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Angle plot design</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co"># grid</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].grid(color <span class="op">=</span> <span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"both"</span>)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].scatter(X[<span class="st">'angle'</span>], xG_predictions, color <span class="op">=</span> <span class="st">'orange'</span>, s <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>)</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">'Angle'</span>)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">'Probability of scoring'</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="co"># axis adjustments</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylim(<span class="dv">0</span>, <span class="fl">0.8</span>)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlim(<span class="dv">0</span>, <span class="fl">3.5</span>)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].yaxis.get_major_ticks()[<span class="dv">0</span>].label1.set_visible(<span class="va">False</span>)</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].tick_params(length <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(x <span class="op">=</span> <span class="dv">44</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>, s <span class="op">=</span> <span class="st">'a)'</span>, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(x <span class="op">=</span> <span class="fl">1.72</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>, s <span class="op">=</span> <span class="st">'b)'</span>, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="building_model_files/figure-html/fig-4-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure 4: Probability of scoring decreases with increasing distance (a) and increases with increasing angle (b).</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As it can be seen from a) part of <a href="#fig-4">Figure&nbsp;4</a>, indeed, probability of scoring (or you can also call it xG value) decreases exponentially with increasing distance. On the contrast, probability of scoring increases in a linear shape with increasing angle.</p>
<p>In both plots of <a href="#fig-4">Figure&nbsp;4</a>, there are densely populated parts that can be analyzed in a slightly different way. These are the areas from where majority of shots is executed. When analyzing <a href="#fig-5">Figure&nbsp;5</a>, we can observe that most of the shots are executed within a distance range of 5 to 30 meters. Similarly, most of the angles of executed shots are distributed within 0 to 60 degrees (0 to 1 radian respectively).</p>
<div class="cell" data-scrolled="true" data-execution_count="393">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canvas</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">1</span>, ncols <span class="op">=</span> <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">14</span>, <span class="dv">4</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance density plot design</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].grid(color <span class="op">=</span> <span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"both"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'distance'</span>, data <span class="op">=</span> shots, ax <span class="op">=</span> ax[<span class="dv">0</span>], color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">'Distance'</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>, <span class="fl">0.045</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_yticks(np.arange(<span class="dv">0</span>, <span class="fl">0.045</span>, <span class="fl">0.01</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlim(<span class="op">-</span><span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Angle density plot design</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].grid(color <span class="op">=</span> <span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"both"</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'angle'</span>, data <span class="op">=</span> shots, ax <span class="op">=</span> ax[<span class="dv">1</span>], color <span class="op">=</span> <span class="st">'orange'</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">'Angle'</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylim(<span class="dv">0</span>, <span class="fl">2.8</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(x <span class="op">=</span> <span class="dv">44</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">0.01</span>, s <span class="op">=</span> <span class="st">'a)'</span>, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(x <span class="op">=</span> <span class="fl">1.5</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">0.63</span>, s <span class="op">=</span> <span class="st">'b)'</span>, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="building_model_files/figure-html/fig-5-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure 5: Distribution of distances (a) and angles for shots (b).</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="statistical-analysis-of-features" class="level2">
<h2 class="anchored" data-anchor-id="statistical-analysis-of-features">Statistical Analysis of Features</h2>
<p>I run a logistic regression including all features that could help me understand the statistical signficance of these features. My intention is to analyze p-values for each of the features, and determine which of those values are weakly associated with the response.</p>
<div class="cell" data-execution_count="428">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> shots.loc[:, [<span class="st">'play_pattern_name'</span>,<span class="st">'under_pressure'</span>, <span class="st">'distance'</span>, <span class="st">'angle'</span>, <span class="st">'gk_loc_x'</span>, <span class="st">'gk_loc_y'</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'follows_dribble'</span>, <span class="st">'first_time'</span>, <span class="st">'open_goal'</span>, <span class="st">'technique'</span>, <span class="st">'body_part'</span>]]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> shots.loc[:, <span class="st">'outcome'</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> pd.concat([X, y], axis <span class="op">=</span> <span class="dv">1</span>).reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># run model</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>logreg_model <span class="op">=</span> smf.logit(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    formula <span class="op">=</span> <span class="st">"outcome ~ distance + angle + under_pressure + gk_loc_y + gk_loc_x + </span><span class="ch">\</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="st">    body_part + open_goal + play_pattern_name"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                         data <span class="op">=</span> df_train).fit()</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(logreg_model.pvalues, columns <span class="op">=</span> [<span class="st">'p-value'</span>]).<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.284721
         Iterations 8</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="428">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>0.000</td>
    </tr>
    <tr>
      <th>body_part[T.Left Foot]</th>
      <td>0.000</td>
    </tr>
    <tr>
      <th>body_part[T.Other]</th>
      <td>0.642</td>
    </tr>
    <tr>
      <th>body_part[T.Right Foot]</th>
      <td>0.000</td>
    </tr>
    <tr>
      <th>play_pattern_name[T.From Counter]</th>
      <td>0.001</td>
    </tr>
    <tr>
      <th>play_pattern_name[T.From Free Kick]</th>
      <td>0.000</td>
    </tr>
    <tr>
      <th>play_pattern_name[T.From Goal Kick]</th>
      <td>0.000</td>
    </tr>
    <tr>
      <th>play_pattern_name[T.From Keeper]</th>
      <td>0.203</td>
    </tr>
    <tr>
      <th>play_pattern_name[T.From Kick Off]</th>
      <td>0.239</td>
    </tr>
    <tr>
      <th>play_pattern_name[T.From Throw In]</th>
      <td>0.001</td>
    </tr>
    <tr>
      <th>play_pattern_name[T.Other]</th>
      <td>0.252</td>
    </tr>
    <tr>
      <th>play_pattern_name[T.Regular Play]</th>
      <td>0.000</td>
    </tr>
    <tr>
      <th>distance</th>
      <td>0.000</td>
    </tr>
    <tr>
      <th>angle</th>
      <td>0.000</td>
    </tr>
    <tr>
      <th>under_pressure</th>
      <td>0.056</td>
    </tr>
    <tr>
      <th>gk_loc_y</th>
      <td>0.431</td>
    </tr>
    <tr>
      <th>gk_loc_x</th>
      <td>0.000</td>
    </tr>
    <tr>
      <th>open_goal</th>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>There are several categorical variables which have very high p-values. These are <strong>body_part[T.Other]</strong>, <strong>play_pattern_name[T.From Keeper]</strong>, <strong>play_pattern_name[T.From Kick Off]</strong>, <strong>play_pattern_name[T.Other]</strong> and <strong>gk_loc_y</strong>. Let us break down those features and consider if we can leave them out of our model.</p>
<p>First, there is a <strong>play_pattern_name</strong> column that describes different attacking phases in which a shot was executed. As it can be seen from below code snippet, there are in total 9 attacking phases.</p>
<div class="cell" data-execution_count="431">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>shots.loc[:, <span class="st">'play_pattern_name'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="431">
<pre><code>array(['Regular Play', 'From Free Kick', 'From Throw In', 'From Counter',
       'From Corner', 'From Keeper', 'From Goal Kick', 'From Kick Off',
       'Other'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="454">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>play_types <span class="op">=</span> pd.DataFrame(shots.loc[:, <span class="st">'play_pattern_name'</span>].value_counts()).reset_index()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>play_types.columns <span class="op">=</span> [<span class="st">'play_pattern_name'</span>, <span class="st">'n'</span>]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>play_types <span class="op">=</span> play_types.sort_values(by <span class="op">=</span> <span class="st">'n'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>body_part <span class="op">=</span> pd.DataFrame(shots.loc[:, <span class="st">'body_part'</span>].value_counts()).reset_index()</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>body_part.columns <span class="op">=</span> [<span class="st">'body_part'</span>, <span class="st">'n'</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>body_part <span class="op">=</span> body_part.sort_values(by <span class="op">=</span> <span class="st">'n'</span>, ascending <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Canvas</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">1</span>, ncols <span class="op">=</span> <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># grid specs</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].grid(color <span class="op">=</span> <span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Main plot</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>pl <span class="op">=</span> ax[<span class="dv">0</span>].barh(play_types[<span class="st">"play_pattern_name"</span>], play_types[<span class="st">"n"</span>], height <span class="op">=</span> <span class="fl">0.6</span>, label <span class="op">=</span> <span class="st">'n'</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>       color <span class="op">=</span> <span class="st">'skyblue'</span>, edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot labels</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].bar_label(pl, padding <span class="op">=</span> <span class="dv">5</span>, label_type<span class="op">=</span><span class="st">'edge'</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels and titles</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Type of Play"</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"# of instances"</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].tick_params(axis <span class="op">=</span> <span class="st">'both'</span>, which <span class="op">=</span> <span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">""</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">1</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co">#############################################################################</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co"># grid specs</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].grid(color <span class="op">=</span> <span class="st">'black'</span>, ls <span class="op">=</span> <span class="st">'-.'</span>, lw <span class="op">=</span> <span class="fl">0.25</span>, axis <span class="op">=</span> <span class="st">"x"</span>)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Main plot</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>pl2 <span class="op">=</span> ax[<span class="dv">1</span>].barh(body_part[<span class="st">"body_part"</span>], body_part[<span class="st">"n"</span>], height <span class="op">=</span> <span class="fl">0.6</span>, label <span class="op">=</span> <span class="st">'n'</span>,</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>       color <span class="op">=</span> <span class="st">'red'</span>, edgecolor <span class="op">=</span> <span class="st">"black"</span>, zorder <span class="op">=</span> <span class="dv">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>) </span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot labels</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].bar_label(pl2, padding <span class="op">=</span> <span class="dv">5</span>, label_type<span class="op">=</span><span class="st">'edge'</span>)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels and titles</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">"Body part"</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"# of instances"</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].tick_params(axis <span class="op">=</span> <span class="st">'both'</span>, which <span class="op">=</span> <span class="st">'major'</span>, labelsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">""</span>, loc <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="dv">1</span>, fontdict <span class="op">=</span> font)</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="co"># set the spacing between subplots</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(left <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>                    bottom <span class="op">=</span> <span class="fl">1.3</span>, </span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>                    right <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>                    top <span class="op">=</span> <span class="dv">2</span>, </span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>                    wspace <span class="op">=</span> <span class="fl">0.65</span>, </span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>                    hspace <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="building_model_files/figure-html/fig-6-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure 6: Distribution of shots in different types of play (left) and implemented with different parts of body (right).</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Features <strong>play_pattern_name[T.From Keeper]</strong>, <strong>play_pattern_name[T.From Kick Off]</strong>, <strong>play_pattern_name[T.Other]</strong> that received high p-values are actually very rare events and can be considered as outliers in our model. There are very few situations in which attack starting from goalkeeper or from a kick-off can result into a goal. From <a href="#fig-6">Figure&nbsp;6</a>, it can be seen that in total 300 shots were executed in types of play: â€˜From Keeperâ€™, â€˜From Kick Offâ€™ and â€˜Otherâ€™.</p>
<div class="cell" data-scrolled="true" data-execution_count="470">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">sum</span>(shots.loc[shots[<span class="st">'play_pattern_name'</span>] <span class="op">==</span> <span class="st">'From Keeper'</span>, <span class="st">'outcome'</span>]), </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>     <span class="st">'goals were scored when attack was initiated from goal keeper.'</span>,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>13 goals were scored when attack was initiated from goal keeper.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="471">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">sum</span>(shots.loc[shots[<span class="st">'play_pattern_name'</span>] <span class="op">==</span> <span class="st">'From Kick Off'</span>, <span class="st">'outcome'</span>]),</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">'goals were scored when attack was initiated from kick-off.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>10 goals were scored when attack was initiated from kick-off.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="472">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">sum</span>(shots.loc[shots[<span class="st">'play_pattern_name'</span>] <span class="op">==</span> <span class="st">'Other'</span>, <span class="st">'outcome'</span>]),</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">'goals were scored when attack was initiated from other scenarios.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>7 goals were scored when attack was initiated from other scenarios.</code></pre>
</div>
</div>
<p>In total, only 30 out of those 300 shots were scored.</p>
<p>Similar pattern can be observed when analyzing <code>body_part</code> categorical column and <strong>body_part[T.Other]</strong> feature that received a high p-value in our logistic regression. Out of 11043 shots available in our dataset, only 30 shots were executed with body part other than foot or head.</p>
<div class="cell" data-execution_count="475">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Only'</span>, np.<span class="bu">sum</span>(shots.loc[shots[<span class="st">'body_part'</span>] <span class="op">==</span> <span class="st">'Other'</span>, <span class="st">'outcome'</span>]),</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">'goals out of 30 shots were scored when body part other than foot or head.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Only 6 goals out of 30 shots were scored when body part other than foot or head.</code></pre>
</div>
</div>
<p>To sum up both of these scenarios, we see that there are only 330 shots and 36 goals which fall into this outlying conditions. This is a relatively small sample size in comparison to the available data, thus, I exclude this data points from the dataset.</p>
<div class="cell" data-execution_count="489">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>shots <span class="op">=</span> shots.loc[<span class="op">~</span>((shots[<span class="st">'play_pattern_name'</span>] <span class="op">==</span> <span class="st">'Other'</span>) <span class="op">|</span> (shots[<span class="st">'play_pattern_name'</span>] <span class="op">==</span> <span class="st">'From Keeper'</span> ) </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> (shots[<span class="st">'play_pattern_name'</span>] <span class="op">==</span> <span class="st">'From Kick Off'</span>) <span class="op">|</span> (shots[<span class="st">'body_part'</span>] <span class="op">==</span> <span class="st">'Other'</span>)),  :]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, there is one more column <code>gk_loc_y</code> which also has a high p-value. This column together with <code>gk_loc_x</code> describe a location of goalkeeper during an executed shot. Naturally, goalkeeper standing on the goal line mainly can move differently but in most of the cases along the goal line. This means that her/his y coordinate should change much more frequently than x coordinate. However, what we see is that y coordinate is less significant in our model than x coordinate. As of now, I will leave both of these features in the dataset and will their impact again later when evaluating model performance with different algorithms.</p>
</section>
<section id="transforming-and-splitting-data" class="level2">
<h2 class="anchored" data-anchor-id="transforming-and-splitting-data">Transforming and Splitting Data</h2>
<div class="cell" data-execution_count="517">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare features and labels from available data</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> shots.loc[:, [<span class="st">'play_pattern_name'</span>,<span class="st">'under_pressure'</span>, <span class="st">'distance'</span>, <span class="st">'angle'</span>, <span class="st">'gk_loc_x'</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'follows_dribble'</span>, <span class="st">'first_time'</span>, <span class="st">'open_goal'</span>, <span class="st">'technique'</span>, <span class="st">'body_part'</span>]]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> shots.loc[:, <span class="st">'outcome'</span>]</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># split data</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>X_valid, X_test, y_valid, y_test <span class="op">=</span> train_test_split(X_test, y_test, test_size <span class="op">=</span> <span class="fl">0.5</span>, random_state <span class="op">=</span> <span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="518">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>column_trans <span class="op">=</span> ColumnTransformer(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    [(<span class="st">'encode_bodyparts'</span>, OneHotEncoder(dtype<span class="op">=</span><span class="st">'int'</span>), [<span class="st">'play_pattern_name'</span>, <span class="st">'technique'</span>, <span class="st">'body_part'</span>]),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'std_coords'</span>, StandardScaler(), [<span class="st">'distance'</span>, <span class="st">'angle'</span>, <span class="st">'gk_loc_x'</span>])],</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'passthrough'</span>, verbose_feature_names_out <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>X_train_trans <span class="op">=</span> column_trans.fit_transform(X_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="models-comparison" class="level2">
<h2 class="anchored" data-anchor-id="models-comparison">Modelsâ€™ Comparison</h2>
<p><strong>Logistic Regression | Default Approach</strong></p>
<div class="cell" data-execution_count="519">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score, brier_score_loss</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Logistic Regression Model</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>xG_model <span class="op">=</span> LogisticRegression()</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>xG_model.fit(X_train_trans, y_train)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>xG_predictions <span class="op">=</span> xG_model.predict_proba(X_train_trans)[:, <span class="dv">1</span>]</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_train, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="519">
<pre><code>0.7932825029297309</code></pre>
</div>
</div>
<div class="cell" data-execution_count="520">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>X_valid_trans <span class="op">=</span> column_trans.transform(X_valid)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>xG_predictions <span class="op">=</span> xG_model.predict_proba(X_valid_trans)[:, <span class="dv">1</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_valid, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="520">
<pre><code>0.7444304100699057</code></pre>
</div>
</div>
<div class="cell" data-execution_count="521">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>brier_score_loss(y_valid, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="521">
<pre><code>0.07530598392177701</code></pre>
</div>
</div>
<p><strong>Gradient Boosting | Best Performer</strong></p>
<div class="cell" data-execution_count="522">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># features used:</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># X = shots.loc[:, ['play_pattern_name','under_pressure', 'distance', 'angle', 'gk_loc_x', 'gk_loc_y',</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                   'follows_dribble', 'first_time', 'open_goal', 'technique', 'body_part']]</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingClassifier</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> GradientBoostingClassifier(n_estimators <span class="op">=</span> <span class="dv">500</span>, learning_rate <span class="op">=</span> <span class="fl">0.035</span>, loss <span class="op">=</span> <span class="st">'exponential'</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">0</span>).fit(X_train_trans, y_train)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>xG_predictions <span class="op">=</span> clf.predict_proba(X_train_trans)[:, <span class="dv">1</span>]</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_train, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="522">
<pre><code>0.8523929552072906</code></pre>
</div>
</div>
<div class="cell" data-execution_count="523">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>X_valid_trans <span class="op">=</span> column_trans.transform(X_valid)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>xG_predictions <span class="op">=</span> clf.predict_proba(X_valid_trans)[:, <span class="dv">1</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_valid, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="523">
<pre><code>0.7422036629717546</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="524">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>brier_score_loss(y_valid, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="524">
<pre><code>0.07677725372860654</code></pre>
</div>
</div>
<p><strong>MLP | Not enough data to improve performance</strong></p>
<div class="cell" data-execution_count="525">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> MLPClassifier(random_state<span class="op">=</span><span class="dv">1</span>, activation <span class="op">=</span> <span class="st">'tanh'</span>, hidden_layer_sizes <span class="op">=</span> (<span class="dv">80</span>, <span class="dv">80</span>, <span class="dv">30</span>, <span class="dv">30</span>), alpha <span class="op">=</span> <span class="fl">0.0001</span>, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                     learning_rate = 'adaptive', </span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                    solver <span class="op">=</span> <span class="st">'sgd'</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                    max_iter <span class="op">=</span> <span class="dv">700</span>).fit(X_train_trans, y_train)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>xG_predictions <span class="op">=</span> clf.predict_proba(X_train_trans)[:, <span class="dv">1</span>]</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_train, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="525">
<pre><code>0.7883354146095913</code></pre>
</div>
</div>
<div class="cell" data-execution_count="526">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>X_valid_trans <span class="op">=</span> column_trans.transform(X_valid)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>xG_predictions <span class="op">=</span> clf.predict_proba(X_valid_trans)[:, <span class="dv">1</span>]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_valid, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="526">
<pre><code>0.7484701321892898</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="513">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>brier_score_loss(y_valid, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="513">
<pre><code>0.07539088442913291</code></pre>
</div>
</div>
<p><strong>Random Forrest | Performance Close to Gradient Boosting</strong></p>
<div class="cell" data-execution_count="527">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># clf = RandomForestClassifier(max_depth = 10, random_state = 12, criterion = 'entropy')</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> RandomForestClassifier(max_depth <span class="op">=</span> <span class="dv">10</span>, random_state <span class="op">=</span> <span class="dv">12</span>, criterion <span class="op">=</span> <span class="st">'entropy'</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>clf.fit(X_train_trans, y_train)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>xG_predictions <span class="op">=</span> clf.predict_proba(X_train_trans)[:, <span class="dv">1</span>]</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_train, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="527">
<pre><code>0.9121693589441353</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="528">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>X_valid_trans <span class="op">=</span> column_trans.transform(X_valid)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>xG_predictions <span class="op">=</span> clf.predict_proba(X_valid_trans)[:, <span class="dv">1</span>]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>roc_auc_score(y_valid, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="528">
<pre><code>0.7357738626712255</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="529">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>brier_score_loss(y_valid, xG_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="529">
<pre><code>0.07679120654707627</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>